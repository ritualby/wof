---
const { title = "World of Fantasy 2025 - The Ultimate Music Experience" } = Astro.props;
import "../styles/global.css";
---
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="World of Fantasy - The Most Spectacular Show" />
    <meta name="theme-color" content="#e935c1" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/icon-192.png" />
    <title>{title}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  </head>
  <body class="bg-black text-white antialiased">
    <slot />
    
    <script>
      // Smooth scroll animation
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      });

      // Fade in elements on scroll
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('fade-in-up');
          }
        });
      }, { threshold: 0.1 });

      document.querySelectorAll('.observe').forEach(el => observer.observe(el));

      // PWA - Add to Home Screen prompt
      let deferredPrompt;
      const installButton = document.createElement('button');
      installButton.id = 'install-button';
      installButton.innerHTML = `
        <div class="flex items-center gap-3">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
          </svg>
          <span>Add to Home Screen</span>
        </div>
      `;
      installButton.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(135deg, #e935c1 0%, #a855f7 50%, #06b6d4 100%);
        color: white;
        border: none;
        padding: 14px 24px;
        border-radius: 50px;
        font-weight: bold;
        font-size: 14px;
        cursor: pointer;
        z-index: 1000;
        box-shadow: 0 10px 40px rgba(233, 53, 193, 0.4);
        opacity: 0;
        transform: translateY(100px) scale(0.8);
        transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        display: none;
      `;

      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        // Show button with fluid animation
        installButton.style.display = 'block';
        setTimeout(() => {
          installButton.style.opacity = '1';
          installButton.style.transform = 'translateY(0) scale(1)';
        }, 100);
      });

      installButton.addEventListener('click', async () => {
        if (!deferredPrompt) return;
        
        // Animate button press
        installButton.style.transform = 'scale(0.95)';
        setTimeout(() => {
          installButton.style.transform = 'scale(1)';
        }, 100);

        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        
        if (outcome === 'accepted') {
          // Hide button with fluid animation
          installButton.style.opacity = '0';
          installButton.style.transform = 'translateY(100px) scale(0.8)';
          setTimeout(() => {
            installButton.style.display = 'none';
          }, 600);
        }
        
        deferredPrompt = null;
      });

      // Hover effect
      installButton.addEventListener('mouseenter', () => {
        installButton.style.transform = 'scale(1.05)';
        installButton.style.boxShadow = '0 15px 50px rgba(233, 53, 193, 0.6)';
      });

      installButton.addEventListener('mouseleave', () => {
        installButton.style.transform = 'scale(1)';
        installButton.style.boxShadow = '0 10px 40px rgba(233, 53, 193, 0.4)';
      });

      document.body.appendChild(installButton);
    </script>
  </body>
</html>
